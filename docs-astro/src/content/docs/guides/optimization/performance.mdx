---
title: Performance Optimization
description: Comprehensive guide to optimizing Next Commerce SDK performance for faster loading, better Core Web Vitals, and enhanced user experience.
---

# Performance Optimization

Optimize your Next Commerce implementation for maximum performance with techniques covering SDK loading, cart operations, checkout flow, and Core Web Vitals improvements.

## Performance Overview

The Next Commerce SDK is designed for performance out-of-the-box, but proper configuration and optimization techniques can further enhance your site's speed and user experience.

### Key Performance Metrics

- **Time to Interactive (TTI)** - When users can interact with cart
- **First Contentful Paint (FCP)** - When content first appears
- **Largest Contentful Paint (LCP)** - When main content loads
- **Cumulative Layout Shift (CLS)** - Visual stability
- **Cart Operation Speed** - Add/update/remove responsiveness

## SDK Loading Optimization

### Preloading Strategy

#### Module Preloading
```html
<!-- Preload SDK for faster initialization -->
<link rel="modulepreload" href="https://cdn.jsdelivr.net/gh/NextCommerceCo/campaign-cart@latest/dist/index.js">

<!-- Preload dependencies -->
<link rel="preconnect" href="https://core.spreedly.com" crossorigin>
<link rel="preconnect" href="https://api.nextcommerce.co" crossorigin>

<!-- Load SDK with optimized configuration -->
<script>
window.nextConfig = {
  apiKey: 'your-api-key',
  
  // Performance optimizations
  performance: {
    preloadCampaign: true,        // Preload campaign data
    cacheExpiry: 60,              // Cache for 60 minutes
    lazyLoad: ['analytics'],      // Lazy load non-critical features
    debounceCartUpdates: 300      // Debounce cart updates (300ms)
  }
};
</script>

<script src="https://cdn.jsdelivr.net/gh/NextCommerceCo/campaign-cart@latest/public/loader.js"></script>
```

#### Critical Resource Prioritization
```html
<!-- Prioritize critical resources -->
<link rel="preload" href="/fonts/main-font.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/css/cart-styles.css" as="style">

<!-- Defer non-critical resources -->
<link rel="preload" href="/js/analytics.js" as="script">
<script defer src="/js/analytics.js"></script>
```

### Configuration Optimization

#### Lightweight Configuration
```javascript
// Optimized configuration for performance
window.nextConfig = {
  apiKey: 'your-api-key',
  
  // Minimal analytics for faster loading
  analytics: {
    enabled: true,
    mode: 'manual',  // Only track what you need
    providers: {
      nextCampaign: { enabled: true },
      // Disable unused providers to reduce bundle size
      facebook: { enabled: false },
      custom: { enabled: false }
    }
  },
  
  // Optimize payment configuration
  paymentConfig: {
    expressCheckout: {
      requireValidation: false,  // Skip validation for faster checkout
      // Only enable needed payment methods
      methods: {
        paypal: true,
        applePay: true,
        googlePay: false  // Disable if not needed
      }
    }
  },
  
  // Performance settings
  performance: {
    preloadCampaign: true,
    cacheExpiry: 120,  // Longer cache for better performance
    lazyLoad: ['analytics', 'expressCheckout'],
    debounceCartUpdates: 200
  }
};
```

## Cart Performance Optimization

### Efficient Cart Operations

#### Optimized Cart Updates
```javascript
window.nextReady.push(function() {
  // Batch cart operations for better performance
  const cartOperations = [];
  
  function addToCartOptimized(packageId, quantity) {
    cartOperations.push({ action: 'add', packageId, quantity });
    
    // Debounce operations
    clearTimeout(window.cartUpdateTimeout);
    window.cartUpdateTimeout = setTimeout(() => {
      processBatchedOperations();
    }, 300);
  }
  
  function processBatchedOperations() {
    if (cartOperations.length === 0) return;
    
    // Process all operations at once
    cartOperations.forEach(op => {
      if (op.action === 'add') {
        next.addToCart(op.packageId, op.quantity);
      }
    });
    
    cartOperations.length = 0; // Clear queue
  }
});
```

#### Virtualized Cart Display
```html
<!-- Optimize large cart displays with virtualization -->
<template id="cart-item-template">
  <div class="cart-item" data-item-id="{item.id}">
    <img data-src="{item.image}" alt="{item.name}" class="lazy-load">
    <div class="item-details">
      <h4>{item.name}</h4>
      <span class="price">{item.price}</span>
      <input type="number" value="{item.quantity}" 
             data-next-action="update-quantity" 
             data-next-item-id="{item.id}">
    </div>
  </div>
</template>

<div data-next-cart-items 
     data-item-template-id="cart-item-template"
     data-virtual-scrolling="true"
     data-item-height="80">
</div>
```

### Lazy Loading Implementation

#### Image Lazy Loading
```html
<!-- Lazy load product images -->
<img data-next-display="packages[0].image" 
     loading="lazy" 
     decoding="async"
     alt="Product Image">

<!-- Use optimized image formats -->
<picture>
  <source srcset="image.webp" type="image/webp">
  <source srcset="image.avif" type="image/avif">
  <img data-next-display="packages[0].image" alt="Product">
</picture>
```

#### Progressive Loading
```javascript
window.nextReady.push(function() {
  // Progressive loading strategy
  const observer = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        const element = entry.target;
        
        // Load content when visible
        if (element.dataset.nextAction === 'load-content') {
          loadProductContent(element);
          observer.unobserve(element);
        }
      }
    });
  });
  
  // Observe elements for lazy loading
  document.querySelectorAll('[data-next-action="load-content"]')
    .forEach(el => observer.observe(el));
});
```

## Checkout Optimization

### Streamlined Checkout Flow

#### Express Checkout Configuration
```javascript
window.nextConfig = {
  apiKey: 'your-api-key',
  paymentConfig: {
    expressCheckout: {
      // Optimize for speed
      requireValidation: false,
      skipAddressValidation: true,
      
      // Preload payment methods
      preloadMethods: ['paypal', 'applePay'],
      
      // Fast checkout flow
      autoSubmit: true,
      skipConfirmation: false
    }
  }
};
```

#### Optimized Form Handling
```html
<!-- Minimize form fields for faster completion -->
<form id="checkout-form" data-next-checkout-form>
  <!-- Essential fields only -->
  <input type="email" name="email" required 
         autocomplete="email" placeholder="Email">
  <input type="text" name="fname" required 
         autocomplete="given-name" placeholder="First Name">
  <input type="text" name="lname" required 
         autocomplete="family-name" placeholder="Last Name">
  
  <!-- Group related fields -->
  <fieldset>
    <legend>Shipping Address</legend>
    <input type="text" name="address1" required 
           autocomplete="address-line1" placeholder="Address">
    <input type="text" name="city" required 
           autocomplete="address-level2" placeholder="City">
    <input type="text" name="zip" required 
           autocomplete="postal-code" placeholder="ZIP">
  </fieldset>
  
  <button data-next-action="checkout" type="submit">
    Complete Order
  </button>
</form>
```

### Payment Processing Optimization

#### Preloaded Payment Methods
```javascript
window.nextReady.push(function() {
  // Preload payment providers for faster checkout
  if (next.getConfig().paymentConfig?.expressCheckout?.enabled) {
    // Preload PayPal
    if (window.paypal) {
      window.paypal.Buttons({
        style: { layout: 'horizontal' },
        onInit: function() {
          console.log('PayPal preloaded');
        }
      });
    }
    
    // Preload Apple Pay
    if (window.ApplePaySession) {
      const applePay = window.ApplePaySession.canMakePayments();
      console.log('Apple Pay available:', applePay);
    }
  }
});
```

## Core Web Vitals Optimization

### Largest Contentful Paint (LCP)

#### Critical Content Optimization
```html
<!-- Optimize LCP with proper resource loading -->
<style>
  /* Critical CSS for above-the-fold content */
  .hero-product {
    font-display: swap; /* Prevent layout shift */
  }
  
  .product-image {
    aspect-ratio: 1 / 1; /* Prevent layout shift */
    background: #f5f5f5; /* Placeholder color */
  }
</style>

<!-- Prioritize hero image -->
<img data-next-display="packages[0].image" 
     fetchpriority="high" 
     loading="eager"
     class="product-image"
     alt="Main Product">
```

#### Font Loading Optimization
```html
<!-- Optimize font loading for better LCP -->
<link rel="preload" href="/fonts/main-font.woff2" as="font" type="font/woff2" crossorigin>

<style>
  @font-face {
    font-family: 'MainFont';
    src: url('/fonts/main-font.woff2') format('woff2');
    font-display: swap; /* Prevent invisible text */
  }
</style>
```

### Cumulative Layout Shift (CLS)

#### Layout Stability
```css
/* Prevent layout shifts with proper sizing */
.cart-container {
  min-height: 200px; /* Reserve space */
}

.product-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1rem;
}

.product-card {
  aspect-ratio: 3 / 4; /* Maintain consistent dimensions */
}

/* Skeleton loading states */
.loading-skeleton {
  background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
  background-size: 200% 100%;
  animation: loading 1.5s infinite;
}

@keyframes loading {
  0% { background-position: 200% 0; }
  100% { background-position: -200% 0; }
}
```

#### Stable Cart Display
```html
<!-- Prevent layout shifts in cart -->
<div class="cart-summary">
  <!-- Reserve space for cart totals -->
  <div class="total-line">
    <span>Subtotal:</span>
    <span data-next-display="cart.subtotal" class="amount">$0.00</span>
  </div>
  <div class="total-line">
    <span>Shipping:</span>
    <span data-next-display="cart.shipping" class="amount">$0.00</span>
  </div>
  <div class="total-line final">
    <span><strong>Total:</strong></span>
    <span data-next-display="cart.total" class="amount"><strong>$0.00</strong></span>
  </div>
</div>

<style>
.amount {
  min-width: 80px; /* Prevent width changes */
  text-align: right;
  font-variant-numeric: tabular-nums; /* Consistent number width */
}
</style>
```

### First Input Delay (FID)

#### Responsive Interactions
```javascript
window.nextReady.push(function() {
  // Optimize for fast input response
  let isProcessing = false;
  
  // Debounce rapid interactions
  next.on('cart:item-adding', function() {
    if (isProcessing) return false; // Prevent double-clicks
    isProcessing = true;
    
    setTimeout(() => {
      isProcessing = false;
    }, 500);
  });
  
  // Use event delegation for better performance
  document.addEventListener('click', function(e) {
    if (e.target.matches('[data-next-action]')) {
      // Handle all Next Commerce actions efficiently
      e.preventDefault();
      handleNextAction(e.target);
    }
  });
});
```

## Advanced Performance Techniques

### Service Worker Caching

#### Cache Strategy Implementation
```javascript
// service-worker.js
const CACHE_NAME = 'next-commerce-v1';
const urlsToCache = [
  '/css/cart-styles.css',
  '/js/cart-scripts.js',
  '/images/product-placeholder.jpg'
];

self.addEventListener('install', function(event) {
  event.waitUntil(
    caches.open(CACHE_NAME)
      .then(function(cache) {
        return cache.addAll(urlsToCache);
      })
  );
});

self.addEventListener('fetch', function(event) {
  // Cache Next Commerce API responses
  if (event.request.url.includes('api.nextcommerce.co')) {
    event.respondWith(
      caches.open(CACHE_NAME).then(function(cache) {
        return cache.match(event.request).then(function(response) {
          if (response) {
            // Serve from cache
            fetch(event.request).then(function(fetchResponse) {
              cache.put(event.request, fetchResponse.clone());
            });
            return response;
          }
          
          // Fetch and cache
          return fetch(event.request).then(function(fetchResponse) {
            cache.put(event.request, fetchResponse.clone());
            return fetchResponse;
          });
        });
      })
    );
  }
});
```

### Resource Bundling and Splitting

#### Code Splitting Strategy
```javascript
// Lazy load non-critical features
window.nextReady.push(function() {
  // Load analytics only when needed
  if (shouldLoadAnalytics()) {
    import('./analytics.js').then(analytics => {
      analytics.init(next.getConfig().analytics);
    });
  }
  
  // Load express checkout on demand
  document.addEventListener('click', async function(e) {
    if (e.target.matches('[data-express-checkout]')) {
      const expressCheckout = await import('./express-checkout.js');
      expressCheckout.init();
    }
  });
});
```

### Database and API Optimization

#### Request Optimization
```javascript
window.nextReady.push(function() {
  // Batch API requests
  const requestQueue = [];
  let requestTimeout;
  
  function queueRequest(type, data) {
    requestQueue.push({ type, data });
    
    clearTimeout(requestTimeout);
    requestTimeout = setTimeout(processBatchedRequests, 100);
  }
  
  function processBatchedRequests() {
    if (requestQueue.length === 0) return;
    
    // Group similar requests
    const grouped = requestQueue.reduce((acc, req) => {
      if (!acc[req.type]) acc[req.type] = [];
      acc[req.type].push(req.data);
      return acc;
    }, {});
    
    // Send batched requests
    Object.entries(grouped).forEach(([type, items]) => {
      next.batchRequest(type, items);
    });
    
    requestQueue.length = 0;
  }
});
```

## Performance Monitoring

### Real-Time Performance Tracking

#### Core Web Vitals Monitoring
```javascript
// Monitor Core Web Vitals
function trackWebVitals() {
  // Track LCP
  new PerformanceObserver((entryList) => {
    const entries = entryList.getEntries();
    const lastEntry = entries[entries.length - 1];
    
    gtag('event', 'web_vitals', {
      metric_name: 'LCP',
      metric_value: Math.round(lastEntry.startTime),
      metric_rating: lastEntry.startTime > 2500 ? 'poor' : 'good'
    });
  }).observe({ entryTypes: ['largest-contentful-paint'] });
  
  // Track FID
  new PerformanceObserver((entryList) => {
    const entries = entryList.getEntries();
    entries.forEach(entry => {
      gtag('event', 'web_vitals', {
        metric_name: 'FID',
        metric_value: Math.round(entry.processingStart - entry.startTime),
        metric_rating: entry.processingStart - entry.startTime > 100 ? 'poor' : 'good'
      });
    });
  }).observe({ entryTypes: ['first-input'] });
  
  // Track CLS
  let clsValue = 0;
  new PerformanceObserver((entryList) => {
    for (const entry of entryList.getEntries()) {
      if (!entry.hadRecentInput) {
        clsValue += entry.value;
      }
    }
    
    gtag('event', 'web_vitals', {
      metric_name: 'CLS',
      metric_value: Math.round(clsValue * 1000),
      metric_rating: clsValue > 0.1 ? 'poor' : 'good'
    });
  }).observe({ entryTypes: ['layout-shift'] });
}

window.nextReady.push(trackWebVitals);
```

#### Performance Budget Monitoring
```javascript
// Set performance budgets and alerts
const performanceBudgets = {
  lcp: 2500,    // 2.5s
  fid: 100,     // 100ms
  cls: 0.1,     // 0.1
  cartLoad: 500, // 500ms
  checkoutInit: 1000 // 1s
};

window.nextReady.push(function() {
  // Monitor cart performance
  const cartStartTime = performance.now();
  
  next.on('cart:loaded', function() {
    const cartLoadTime = performance.now() - cartStartTime;
    
    if (cartLoadTime > performanceBudgets.cartLoad) {
      console.warn(`Cart load budget exceeded: ${cartLoadTime}ms`);
      
      // Report to analytics
      gtag('event', 'performance_budget_exceeded', {
        metric: 'cart_load',
        value: cartLoadTime,
        budget: performanceBudgets.cartLoad
      });
    }
  });
});
```

## Performance Testing

### Automated Performance Testing

#### Lighthouse CI Integration
```javascript
// lighthouse-ci.js
module.exports = {
  ci: {
    collect: {
      url: [
        'http://localhost:3000/',
        'http://localhost:3000/cart',
        'http://localhost:3000/checkout'
      ],
      numberOfRuns: 3
    },
    assert: {
      assertions: {
        'categories:performance': ['warn', { minScore: 0.8 }],
        'categories:accessibility': ['error', { minScore: 0.9 }],
        'categories:best-practices': ['warn', { minScore: 0.8 }],
        'categories:seo': ['warn', { minScore: 0.8 }]
      }
    },
    upload: {
      target: 'temporary-public-storage'
    }
  }
};
```

#### Performance Test Suite
```javascript
// performance-tests.js
const performanceTests = {
  async testCartOperations() {
    const start = performance.now();
    
    // Test add to cart
    await next.addToCart(1, 1);
    const addTime = performance.now() - start;
    
    console.assert(addTime < 500, `Add to cart too slow: ${addTime}ms`);
    
    // Test cart update
    const updateStart = performance.now();
    await next.updateCartQuantity(1, 2);
    const updateTime = performance.now() - updateStart;
    
    console.assert(updateTime < 300, `Cart update too slow: ${updateTime}ms`);
    
    return { addTime, updateTime };
  },
  
  async testCheckoutFlow() {
    const start = performance.now();
    
    // Simulate checkout initiation
    next.checkout();
    
    // Wait for checkout to initialize
    await new Promise(resolve => {
      next.on('checkout:initialized', resolve);
    });
    
    const checkoutTime = performance.now() - start;
    console.assert(checkoutTime < 1000, `Checkout init too slow: ${checkoutTime}ms`);
    
    return checkoutTime;
  }
};

// Run tests
window.nextReady.push(async function() {
  if (window.location.search.includes('perf-test=true')) {
    const results = await Promise.all([
      performanceTests.testCartOperations(),
      performanceTests.testCheckoutFlow()
    ]);
    
    console.log('Performance test results:', results);
  }
});
```

## Troubleshooting Performance Issues

### Common Performance Bottlenecks

#### Slow Cart Loading
```javascript
// Debug slow cart loading
window.nextReady.push(function() {
  const debugMode = window.location.search.includes('debug-perf=true');
  
  if (debugMode) {
    const cartLoadStart = performance.now();
    
    next.on('cart:loading', function() {
      console.log('Cart loading started...');
    });
    
    next.on('cart:loaded', function() {
      const loadTime = performance.now() - cartLoadStart;
      console.log(`Cart loaded in ${loadTime}ms`);
      
      // Check for potential issues
      if (loadTime > 1000) {
        console.warn('Slow cart loading detected. Possible causes:');
        console.warn('- Network latency');
        console.warn('- Large number of cart items');
        console.warn('- Complex cart templates');
        console.warn('- Missing cache configuration');
      }
    });
  }
});
```

#### Memory Leaks Detection
```javascript
// Monitor memory usage
function monitorMemoryUsage() {
  if (!performance.memory) return;
  
  const checkMemory = () => {
    const memory = performance.memory;
    console.log({
      used: Math.round(memory.usedJSHeapSize / 1048576) + 'MB',
      total: Math.round(memory.totalJSHeapSize / 1048576) + 'MB',
      limit: Math.round(memory.jsHeapSizeLimit / 1048576) + 'MB'
    });
    
    // Alert if memory usage is high
    if (memory.usedJSHeapSize / memory.jsHeapSizeLimit > 0.8) {
      console.warn('High memory usage detected');
    }
  };
  
  // Check memory every 30 seconds
  setInterval(checkMemory, 30000);
  checkMemory(); // Initial check
}

window.nextReady.push(monitorMemoryUsage);
```

## Performance Checklist

### Pre-Launch Optimization
- [ ] Configure SDK performance settings
- [ ] Implement lazy loading for images
- [ ] Optimize font loading
- [ ] Set up resource preloading
- [ ] Configure service worker caching
- [ ] Minimize JavaScript bundle size
- [ ] Optimize CSS delivery

### Ongoing Monitoring
- [ ] Monitor Core Web Vitals
- [ ] Track cart operation performance
- [ ] Monitor checkout completion times
- [ ] Set up performance alerts
- [ ] Regular Lighthouse audits
- [ ] A/B test performance improvements

### Advanced Optimizations
- [ ] Implement code splitting
- [ ] Use CDN for static assets
- [ ] Optimize database queries
- [ ] Configure edge caching
- [ ] Implement prefetching strategies
- [ ] Use web workers for heavy operations

## Related Documentation

- [Configuration](../../configuration/) - Performance configuration options
- [Troubleshooting](../troubleshooting/) - Common performance issues
- [Analytics](../../javascript-api/analytics/) - Performance tracking setup
- [Accessibility](./accessibility/) - Accessible performance optimizations
